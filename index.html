<!doctype html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Cache Control: Force fresh load -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>Consultorio - Dra. Claudia Franco</title>

  <!-- Google Identity Services (Necesario para revocaci贸n cliente) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    window.onload = function () {
      if (window.google && window.google.accounts && window.google.accounts.id) {
        // SOLICITUD DE USUARIO: Configuraci贸n expl铆cita de inicializaci贸n
        // Nota: Requiere 'client_id' para funcionar correctamente en modo Sign-In.
        // Si Supabase no lo expone aqu铆, se usa un placeholder para aplicar la configuraci贸n global.
        try {
          google.accounts.id.initialize({
            client_id: "YOUR_GOOGLE_CLIENT_ID_PLACEHOLDER",
            auto_select: false, // CRTICO: Deshabilita auto-login
            ux_mode: 'redirect'
          });
          // Tambi茅n llamamos al m茅todo directo por si acaso
          window.google.accounts.id.disableAutoSelect();
          console.log("GSI: Initialized with auto_select: false");
        } catch (e) {
          console.warn("GSI Init Error (likely missing client_id):", e);
          // Fallback
          try {
            window.google.accounts.id.disableAutoSelect();
            console.log("GSI: AutoSelect disabled (fallback)");
          } catch (z) { console.error(z); }
        }
      }
    }
  </script>

  <!-- CRITICAL: Script de Limpieza Temprana (Bloqueo de Sesi贸n) -->
  <script>
      (function () {
        // Verificar si estamos en flujo de logout
        const params = new URLSearchParams(window.location.search);
        if (params.get('logout') === 'true') {
          console.warn(" SECURITY: Forced Logout Detected in Head");

          // 1. Limpieza Local Inmediata
          try {
            window.localStorage.clear();
            window.sessionStorage.clear();
          } catch (e) { console.error("Storage clear error", e); }

          // 2. Limpieza de Cookies (Brute Force)
          var cookies = document.cookie.split(";");
          for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i];
            var eqPos = cookie.indexOf("=");
            var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
          }

          // 3. Limpiar URL para evitar bucles, manteniendo el hash si es necesario
          // No recargamos aqu铆 para permitir que la app cargue en estado limpio
          const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
          window.history.replaceState({}, document.title, newUrl);
        }
      })();
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>