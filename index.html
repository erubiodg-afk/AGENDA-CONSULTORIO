<!doctype html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Cache Control: Force fresh load -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>Consultorio - Dra. Claudia Franco</title>

  <!-- Google Identity Services (Necesario para revocaci칩n cliente) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    window.onload = function () {
      if (window.google) {
        // Inicializaci칩n expl칤cita para deshabilitar auto_select globalmente
        // Usamos un client_id dummy o vac칤o si Supabase lo maneja internamente, 
        // pero la configuraci칩n global ayuda.
        // Nota: Sin client_id real esto podr칤a fallar, pero disableAutoSelect() funciona igual.
        try {
          google.accounts.id.initialize({
            client_id: "YOUR_GOOGLE_CLIENT_ID", // Supabase lo inyecta, aqu칤 aseguramos defaults
            auto_select: false,
            ux_mode: 'redirect'
          });
        } catch (e) { console.log("GSI init skipped (managed by Supabase/OAuth flow)"); }
      }
    }
  </script>

  <!-- CRITICAL: Script de Limpieza Temprana (Bloqueo de Sesi칩n) -->
  <script>
      (function () {
        // Verificar si estamos en flujo de logout
        const params = new URLSearchParams(window.location.search);
        if (params.get('logout') === 'true') {
          console.warn("游 SECURITY: Forced Logout Detected in Head");

          // 1. Limpieza Local Inmediata
          try {
            window.localStorage.clear();
            window.sessionStorage.clear();
          } catch (e) { console.error("Storage clear error", e); }

          // 2. Limpieza de Cookies (Brute Force)
          var cookies = document.cookie.split(";");
          for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i];
            var eqPos = cookie.indexOf("=");
            var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
          }

          // 3. Limpiar URL para evitar bucles, manteniendo el hash si es necesario
          // No recargamos aqu칤 para permitir que la app cargue en estado limpio
          const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
          window.history.replaceState({}, document.title, newUrl);
        }
      })();
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>